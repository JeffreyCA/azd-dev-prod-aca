# yaml-language-server: $schema=/workspaces/azure-dev/schemas/alpha/azure.yaml.json
name: dev-prod-aca
services:
  dev-prod-aca:
    project: .
    language: python
    host: containerapp
infra:
  layers:
  - name: base-layer
    path: ./infra/base-layer
  - name: cert-layer
    path: ./infra/cert-layer
workflows:
  up:
   steps:
    - azd: provision base-layer # Provision the main application resources
    - azd: provision base-layer # Trigger hook to set TXT record
    - azd: provision cert-layer # Trigger hook to set A/CNAME record
    - azd: provision base-layer # Bind ACA custom domain to cert
    - azd: deploy
hooks:
  preprovision:
    shell: sh
    run: ./preprovision.sh
    interactive: true
